/*
 *	JavaScript Wordpress editor
 *	Author: 		Ante Primorac
 *	Author URI: 	http://anteprimorac.from.hr
 *	Version: 		1.1
 *	License:
 *		Copyright (c) 2013 Ante Primorac
 *		Permission is hereby granted, free of charge, to any person obtaining a copy
 *		of this software and associated documentation files (the "Software"), to deal
 *		in the Software without restriction, including without limitation the rights
 *		to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 *		copies of the Software, and to permit persons to whom the Software is
 *		furnished to do so, subject to the following conditions:
 *
 *		The above copyright notice and this permission notice shall be included in
 *		all copies or substantial portions of the Software.
 *
 *		THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 *		IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 *		FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 *		AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 *		LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 *		OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 *		THE SOFTWARE.
 *	Usage:
 *		server side(WP):
 *			js_wp_editor( $settings );
 *		client side(jQuery):
 *			$('textarea').wp_editor( options );
 */

!function(e,t){e.fn.wp_editor=function(t){if(e(this).is("textarea")||console.warn("Element must be a textarea"),("undefined"==typeof tinyMCEPreInit||"undefined"==typeof QTags||"undefined"==typeof ap_vars)&&console.warn("js_wp_editor( $settings ); must be loaded"),!e(this).is("textarea")||"undefined"==typeof tinyMCEPreInit||"undefined"==typeof QTags||"undefined"==typeof ap_vars)return this;var i={mode:"html",mceInit:{theme:"modern",skin:"lightgray",language:"en",formats:{alignleft:[{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"left"},deep:!1,remove:"none"},{selector:"img,table,dl.wp-caption",classes:["alignleft"],deep:!1,remove:"none"}],aligncenter:[{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"center"},deep:!1,remove:"none"},{selector:"img,table,dl.wp-caption",classes:["aligncenter"],deep:!1,remove:"none"}],alignright:[{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"right"},deep:!1,remove:"none"},{selector:"img,table,dl.wp-caption",classes:["alignright"],deep:!1,remove:"none"}],strikethrough:{inline:"del",deep:!0,split:!0}},relative_urls:!1,remove_script_host:!1,convert_urls:!1,browser_spellcheck:!0,fix_list_elements:!0,entities:"38,amp,60,lt,62,gt",entity_encoding:"raw",keep_styles:!1,paste_webkit_styles:"font-weight font-style color",preview_styles:"font-family font-size font-weight font-style text-decoration text-transform",wpeditimage_disable_captions:!1,wpeditimage_html5_captions:!1,plugins:"charmap,hr,media,paste,tabfocus,textcolor,fullscreen,wordpress,wpeditimage,wpgallery,wplink,wpdialogs,wpview,image",content_css:ap_vars.includes_url+"css/dashicons.css?ver=3.9,"+ap_vars.includes_url+"js/mediaelement/mediaelementplayer.min.css?ver=3.9,"+ap_vars.includes_url+"js/mediaelement/wp-mediaelement.css?ver=3.9,"+ap_vars.includes_url+"js/tinymce/skins/wordpress/wp-content.css?ver=3.9",selector:"#apid",resize:"vertical",menubar:!1,wpautop:!0,indent:!1,toolbar1:"bold,italic,strikethrough,bullist,numlist,blockquote,hr,alignleft,aligncenter,alignright,link,unlink,wp_more,spellchecker,fullscreen,wp_adv",toolbar2:"formatselect,underline,alignjustify,forecolor,pastetext,removeformat,charmap,outdent,indent,undo,redo,wp_help",toolbar3:"",toolbar4:"",tabfocus_elements:":prev,:next",body_class:"apid"}},s=new RegExp("apid","g");tinyMCEPreInit.mceInit.apid&&(i.mceInit=tinyMCEPreInit.mceInit.apid);var t=e.extend(!0,i,t);return this.each(function(){if(e(this).is("textarea")){var i=e(this).attr("id");e.each(t.mceInit,function(a,n){"string"==e.type(n)&&(t.mceInit[a]=n.replace(s,i))}),t.mode="tmce"==t.mode?"tmce":"html",tinyMCEPreInit.mceInit[i]=t.mceInit,e(this).addClass("wp-editor-area").show();var a=this;if(e(this).closest(".wp-editor-wrap").length){var n=e(this).closest(".wp-editor-wrap").parent();e(this).closest(".wp-editor-wrap").before(e(this).clone()),e(this).closest(".wp-editor-wrap").remove(),a=n.find('textarea[id="'+i+'"]')}var r=e('<div id="wp-'+i+'-wrap" class="wp-core-ui wp-editor-wrap '+t.mode+'-active" />'),l=e('<div id="wp-'+i+'-editor-tools" class="wp-editor-tools hide-if-no-js" />'),o=e('<div class="wp-editor-tabs" />'),d=e('<a id="'+i+'-html" class="wp-switch-editor switch-html" data-wp-editor-id="'+i+'">Text</a>'),p=e('<a id="'+i+'-tmce" class="wp-switch-editor switch-tmce" data-wp-editor-id="'+i+'">Visual</a>'),c=e('<div id="wp-'+i+'-media-buttons" class="wp-media-buttons" />'),m=e('<a href="#" id="insert-media-button" class="button insert-media add_media" data-editor="'+i+'" title="Add Media"><span class="wp-media-buttons-icon"></span> Add Media</a>'),h=e('<div id="wp-'+i+'-editor-container" class="wp-editor-container" />'),w=!1;m.appendTo(c),c.appendTo(l),d.appendTo(o),p.appendTo(o),o.appendTo(l),l.appendTo(r),h.appendTo(r),h.append(e(a).clone().addClass("wp-editor-area")),0!=w&&e.each(w,function(){e('link[href="'+this+'"]').length||e(a).before('<link rel="stylesheet" type="text/css" href="'+this+'">')}),e(a).before('<link rel="stylesheet" id="editor-buttons-css" href="'+ap_vars.includes_url+'css/editor.css" type="text/css" media="all">'),e(a).before(r),e(a).remove(),new QTags(i),QTags._buttonsInit(),switchEditors.go(i,t.mode),e(r).on("click",".insert-media",function(t){var i=e(t.currentTarget),s=i.data("editor"),a={frame:"post",state:"insert",title:wp.media.view.l10n.addMedia,multiple:!0};t.preventDefault(),i.blur(),i.hasClass("gallery")&&(a.state="gallery",a.title=wp.media.view.l10n.createGalleryTitle),wp.media.editor.open(s,a)})}else console.warn("Element must be a textarea")})}}(jQuery,window);